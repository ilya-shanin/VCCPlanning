{% extends 'base_generic.html' %}
{% load static %}
{% block extrafiles %}
<link rel="stylesheet" href="{% static 'fullcalendar/lib/main.css' %}">
<script src="{% static 'fullcalendar/lib/main.js' %}"></script>
<script src="{% static 'fullcalendar/lib/locales/ru.js' %}"></script>
{% endblock extrafiles %}
{% block title %}<title>Главная</title>{% endblock %}
{% block content %}
<div class = "content detail">    

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        var today = new Date();
        var calendar = new FullCalendar.Calendar(calendarEl, {
            height:"650px",
            headerToolbar: {
                left: 'prev,today,next',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay,list'
            },
            initialDate: today,
            navLinks: true, // can click day/week names to navigate views
            initialView: 'dayGridMonth',
            locale: 'ru'
        });
        {% for conf in now_running %}
        calendar.addEvent(
            {
                id: '{{conf.event.pk}}',
                title: '{{conf.event.name}}',
                start: new Date({{conf.event.start_time|date:"U"}}*1000),
                {% if conf.event.end_time %}
                end: new Date({{conf.event.end_time|date:"U"}}*1000)
                {% endif %}
            }
            );
        {% endfor %}
        
        calendar.render();
    });
    </script>
    <div id="calendar" class="mt-3"></div>

    <div class = "dash_events_list mt-3">
        <h3 class="list-title">Всего конференций {{user}}: {{total_count}}</h3>

        <ul class = "list-group-flush">
            <b class="hr-rainbow"></b>
            <hr class="hr-custom">

            {% for conf in now_running %}
            <li class = "list-group-item align-items-start">
                <div class="row">
                    <div class = "col-sm-2">

                        <div class = "c-date">
                            <div class="fw-bold">
                                <i class='bx bx-calendar' ></i>{{conf.event.start_time.date}}
                                {% if conf.event.end_time and conf.event.start_time.date != conf.event.end_time.date %}
                                - {{conf.event.end_time.date}}
                                {% endif %}
                            </div>
                        </div>

                        <div class = "c-time">
                            <p>
                                <i class='bx bx-time-five'></i>    
                                {{conf.event.start_time.time}}
                                {% if conf.event.end_time %}
                                    - {{conf.event.end_time.time}}
                                {% endif %}</p>
                        </div>

                    </div>

                    <div class="col-sm-10">
                        <div class = "fw-bold conf_name">
                            {% if conf.event.live %}
                            <span class = "badge bg-danger rounded-pill">LIVE</span>
                            {% endif %}
                            {{conf.event.name}}
                        </div>

                        <div class = "text-muted conf_text">{{conf.event.notes}}</div>

                    </div>
                </div>

                <div class="row">
                    <div class="col">
                        <div class = "detail-ref">
                            <a href="{{conf.get_absolute_url}}"><i class='bx bx-link-external' ></i>&nbspПерейти</a>
                        </div>
                    </div>
                </div>

            </li>
            <b class="hr-rainbow"></b>
            <hr class="hr-custom">
            {% endfor %}

        </ul>   
    </div>
    
</div>
{% endblock %}